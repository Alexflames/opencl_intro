\documentclass[bachelor, och, times]{SCWorks}
% параметр - тип обучения - одно из значений:
%    spec     - специальность
%    bachelor - бакалавриат (по умолчанию)
%    master   - магистратура
% параметр - форма обучения - одно из значений:
%    och   - очное (по умолчанию)
%    zaoch - заочное
% параметр - тип работы - одно из значений:
%    referat    - реферат
%    coursework - курсовая работа (по умолчанию)
%    diploma    - дипломная работа
%    pract      - отчет по практике
%    pract      - отчет о научно-исследовательской работе
%    autoref    - автореферат выпускной работы
%    assignment - задание на выпускную квалификационную работу
%    review     - отзыв руководителя
%    critique   - рецензия на выпускную работу
% параметр - включение шрифта
%    times    - включение шрифта Times New Roman (если установлен)
%               по умолчанию выключен
\usepackage[T2A]{fontenc}
\usepackage[cp1251]{inputenc}
\usepackage{graphicx}

\usepackage[sort,compress]{cite}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{fancyvrb}
\usepackage{longtable}
\usepackage{array}
\usepackage{xcolor}
\usepackage[english,russian]{babel}

\usepackage[colorlinks=true]{hyperref}


\newcommand{\eqdef}{\stackrel {\rm def}{=}}

\newtheorem{lem}{Лемма}

\begin{document}

% Кафедра (в родительном падеже)
\chair{математической кибернетики и компьютерных наук}

% Тема работы
\title{Вычисления на видеокартах}

% Курс
\course{3}

% Группа
\group{351}

% Факультет (в родительном падеже) (по умолчанию "факультета КНиИТ")
%\department{факультета КНиИТ}

% Специальность/направление код - наименование
%\napravlenie{02.03.02 "--- Фундаментальная информатика и информационные технологии}
%\napravlenie{02.03.01 "--- Математическое обеспечение и администрирование информационных систем}
%\napravlenie{09.03.01 "--- Информатика и вычислительная техника}
\napravlenie{09.03.04 "--- Программная инженерия}
%\napravlenie{10.05.01 "--- Компьютерная безопасность}

% Для студентки. Для работы студента следующая команда не нужна.
%\studenttitle{Студентки}

% Фамилия, имя, отчество в родительном падеже
\author{Григорьева Алексея Александровича}

% Заведующий кафедрой
\chtitle{к.\,ф.-м.\,н.} % степень, звание
\chname{С.\,В.\,Миронов}

%Научный руководитель (для реферата преподаватель проверяющий работу)
\satitle{доцент} %должность, степень, звание
\saname{М.\,С.\,Семенов}

% Руководитель практики от организации (только для практики,
% для остальных типов работ не используется)
\patitle{к.\,ф.-м.\,н., доцент}
\paname{Д.\,Ю.\,Петров}

% Семестр (только для практики, для остальных
% типов работ не используется)
\term{2}

% Наименование практики (только для практики, для остальных
% типов работ не используется)
\practtype{учебная}

% Продолжительность практики (количество недель) (только для практики,
% для остальных типов работ не используется)
\duration{2}

% Даты начала и окончания практики (только для практики, для остальных
% типов работ не используется)
\practStart{01.07.2016}
\practFinish{14.07.2016}

% Год выполнения отчета
\date{2018}

\maketitle

% Включение нумерации рисунков, формул и таблиц по разделам
% (по умолчанию - нумерация сквозная)
% (допускается оба вида нумерации)
%\secNumbering


\tableofcontents

% Раздел "Обозначения и сокращения". Может отсутствовать в работе
%\abbreviations
%\begin{description}
    %\item \foreignlanguage{english}{EVM} "--- %\foreignlanguage{english}{Ethereum Virtual Machine};
%\end{description}

% Раздел "Определения". Может отсутствовать в работе
%\definitions

% Раздел "Определения, обозначения и сокращения". Может отсутствовать в работе.
% Если присутствует, то заменяет собой разделы "Обозначения и сокращения" и "Определения"
%\defabbr


% Раздел "Введение"
\intro
Будет добавлено позже. Немного об истории, сравнение характеристик процессора и видеокарты

\section{Краткая теория}
Составление эффективных алгоритмов вычисления на видеокарте в значительной степени отличается 
от привычных алгоритмов, исполняющихся на процессоре. При составлении программного кода необходимо 
учитывать как и общие особенности видеокарт, так и, возможно, характеристики конкретного устройства, 
для которого программируется алгоритм.

В данном разделе будет рассмотрена типовая модель видеокарты и основные понятия \foreignlanguage{english}{OpenCL},
с которыми будем оперировать в данной работе.

\subsection{Типовая модель видеокарты}
Рассмотрим следующую архитектуру вычислительного устройства, используемого в видеокартах
\foreignlanguage{english}{Nvidia} \ref{SM}.

\begin{figure}[h]
	\centering
	\includegraphics[scale=0.75]{screenshots/videocard-base}
	\caption{Архитектура потокого мультипроцессора Fermi.}\label{SM}
\end{figure}

Вычислительное устройство в архитектуре Nvidia имеет 32 ядра (CUDA cores), каждое из которых является потоком. 
В отличии от процессора, ядра выполняют более узкий набор задач, что позволяет с меньшими затратами 
увеличить их количество в устройстве. 
%\ref{https://www.nvidia.com/content/PDF/fermi_white_papers/NVIDIA_Fermi_Compute_Architecture_Whitepaper.pdf}
Для управления ими существует (warp scheduler), выполняющий роль указателя на инструкции
соответствуя архитектуре SIMD. Данные для вычислений потоки берут из локальной памяти (shared memory), общей для
всех ядер. Достигается это с использованием устройств загрузки и хранения (load-store units), соответственно
способных загружать, а также сохранять данные в локальную память. Между всеми 32 ядрами динамически распределяются
регистры, самая быстрая память, доступная им. У мультипроцессора в наличии намного больше регистров, чем могло быть
нужно для выполнения программы. Это сделано для сокрытия времени на загрузку памяти и быстрого переключения контекста,
подробнее - в разделе [???].
 
Количество таких устройств в видеокарте определяется следующим образом:
\begin{equation*}
\text{Количество ядер в видеокарте / } 32  \text{, в случае Nvidia (warp)   }
\end{equation*}
\begin{equation*}
\text{Количество ядер в видеокарте / } 64  \text{, в случае AMD (wavefront) }
\end{equation*}

Например, видеокарта Nvidia Geforce GTX 1050 Ti имеет 768 ядер CUDA, и, соответственно, 24 warp.

\subsection{Основные понятия OpenCL}
%\ref{http://opencl.ru/node/8}
OpenCL "--- открытый для свободного пользования программный интерфейс для создания параллельных приложений, 
использующих многоядерные структуры как и центрального процессора (CPU), так и графического (GPU).
Использование API необходимо для обеспечения совместимости программы с различными устройствами.

При построении задач, определяется рабочее пространство (NDRange), представляющее все возможные в рамках задачи 
индексы потоков. Размер рабочего пространства определяется программистом на этапе инициализации OpenCL программы.
Рабочее пространство может представлять:
\begin{itemize}
	\item одномерный массив длиной N элементов;
	\item двумерную сетку размерности NxM;
	\item трехмерное пространство размерностью NxMxP.
\end{itemize}

%\ref{https://www.khronos.org/registry/OpenCL/specs/}
Код, выполняющийся параллельно на ядрах процессора, называется kernel. Копия kernel выполняется
для каждого индекса рабочего пространства и называется work-item с глобальным ID, соответствующим
некоторому ID рабочего пространства. Kernel для всех work-item в рабочем пространстве имеют одинаковый код
и входные параметры, но может иметь различный путь выполнения программы соответственно своему глобальному индексу -
индекс в рабочем пространстве, полученному с использованием функции \verb|get_global_id()|. Kernel в отличии
от остальной программы полностью выполняется на видеокарте.

Группа work-item называется work-group, и за каждой группой закреплен собственный warp (см. предыдущий раздел),
в рамках которого work-item могут синхронизироваться. Для каждой рабочей группы существует ее индекс в рабочем
пространстве, и каждый work-item может узнать свой индекс внутри рабочей группы. Нетрудно заметить следующее 
соотношение:
\begin{equation*}
	\text{global ID } = \text{ group ID * размер группы } + \text{ local ID} 
\end{equation*}
Размер рабочей группы аналогично рабочему пространству определяется программистом.

Каждое ядро, выполняя заданный kernel, является work-item в некоторой рабочей группой, на которые разделено
рабочее пространство NDRange.

Рассмотрим на примере следующей схемы~\ref{entities} другие виды сущностей, c которыми будет взаимодействие 
в дальнейшем.
\begin{itemize}
	\item Платформа "--- драйвер, модель взаимодействия OpenCL и устройства. Распространены платформы от следующих
	производителей: Nvidia, Intel, AMD.
	\item Программа "--- хостовая часть, организующая подготовку к вычислениям и набор kernel-подпрограмм.
	\item Kernel "--- программа, исполняющаяся на видеокарте в каждом ядре.
	\item Контекст "--- окружение, в котором исполняется kernel.
	\item Объект памяти "--- создаваемый в контексте объект.
	\item Буфер "--- произвольный массив данных.
\end{itemize}
\begin{figure}[h]
	\centering
	\includegraphics[scale=0.75]{screenshots/opencl-entities}
	\caption{Основные сущности в OpenCL.}\label{entities}
\end{figure}

\section{Алгоритмы на видеокарте}
В данном разделе будет рассмотрена анализ и практическая реализация алгоритмов на видеокарте, включая:
\begin{itemize}
	\item описание общих требований к алгоритмам на основе доступа к памяти и параллельного исполнения;
	\item настройка среды разработки Visual Studio под выполнение параллельных программ с использованием OpenCL;
	\item написание программ для задач, использующих входные данные разных размерностей.
\end{itemize}


\subsection{Требования к алгоритмам}
Любой алгоритм 
%\ref{https://software.intel.com/ru-ru/articles/opencl-20-non-uniform-work-groups}
Требования: наличие массового параллелизма; эффективный доступ к памяти; правильное ветвление и т.д
2 асимптотики, банк-конфликты, code divergence, register spilling, occupancy 

\subsection{Настройка среды разработки}
CMake, VS, да и все

\subsection{Инициализация OpenCL программы}
Ну да, есть такое

\subsection{Задачи на одномерных массивах}
(сумма ряда, какая-нибудь префикс-функция)

\subsection{Задачи на двумерных массивах}
(транспонирование, переменожение матриц)

\subsection{Задача на трехмерных массивах}
(Collision detection)


\newpage
%===========================================
% Раздел "Заключение"
\conclusion
В настоящей работе

%Библиографический список, составленный вручную, без использования BibTeX
%
%\begin{thebibliography}{99}
%  \bibitem{Ione} Источник 1.
%  \bibitem{Itwo} Источник 2
%\end{thebibliography}

%Библиографический список, составленный с помощью BibTeX
%
\bibliographystyle{gost780uv}
\bibliography{thesis}

% Окончание основного документа и начало приложений
% Каждая последующая секция документа будет являться приложением

\appendix

\section{Листинг программы}\label{pril-1}
Код

%\VerbatimInput[fontsize=\small, numbers=left, numbersep=2pt]{example.sol}


\end{document}
